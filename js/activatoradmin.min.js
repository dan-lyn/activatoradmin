var ActivatorItem={},ActivatorList={},ActivatorItemView={},ActivatorPaginationView={},ActivatorAppView={};
require("text!templates/item.tpl text!templates/pagination.tpl jquery bootstrap underscore backbone backbonePaginator".split(" "),function(g,h){var e="";"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("baseUrl")&&(e=appConfig.baseUrl);var f=5;"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("pageSize")&&(f=appConfig.pageSize);ActivatorItem=Backbone.Model.extend({urlRoot:e+"item",idAttribute:"id",initialize:function(){"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("db_mapping")&&
(appConfig.db_mapping.hasOwnProperty("name")&&""!==appConfig.db_mapping.name&&this.set("name",this.get(appConfig.db_mapping.name)),appConfig.db_mapping.hasOwnProperty("isactive")&&""!==appConfig.db_mapping.isactive&&this.set("isactive",this.get(appConfig.db_mapping.isactive)),appConfig.db_mapping.hasOwnProperty("image")&&""!==appConfig.db_mapping.image&&this.set("image",this.get(appConfig.db_mapping.image)))}});ActivatorList=Backbone.PageableCollection.extend({model:ActivatorItem,url:e+"items",state:{firstPage:1,
currentPage:1,pageSize:f}});var b=new ActivatorList([],{mode:"client"});ActivatorItemView=Backbone.View.extend({tagName:"li",className:"well",template:_.template(g),events:{"click .toggle-activate":"toggleActivate","click img":"toggleImage"},initialize:function(){},render:function(){var a=this.model,c="";if(""!==a.get("image")&&null!==a.get("image")&&"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("imagePath")&&""!==appConfig.imagePath&&0!==a.get("image").indexOf(e+appConfig.imagePath))c=
e+appConfig.imagePath+a.get("image"),a.set("image",c);else if(""===a.get("image")||null===a.get("image"))c=e+"images/default.jpg",a.set("image",c);c=a.toJSON();"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete?c.show_delete=appConfig.show_delete:c.show_delete=!1;"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_info")&&appConfig.show_info?c.show_info=appConfig.show_info:c.show_info=!1;this.$el.html(this.template(c));this.$el.find("label").tooltip({placement:"left"});
if("undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete)this.$el.find("#itemDelete-"+a.get("id")).find("#itemDeleteConfirm").on("click",function(){a.destroy({success:function(a,c){b.getFirstPage({fetch:!0});$(".modal-backdrop").remove()}})});return this.$el},toggleActivate:function(){var a=this.$el.find(".toggle-activate").get(0).checked?1:0;this.model.save({isactive:a});this.render()},toggleImage:function(){var a=this.model.get("image"),b=this.$el.find("img").get(0).offsetTop,
d=this.$el.find("img").get(0).offsetLeft;$("body").append('<div id="background"></div>');$("#background").show("fast","linear",function(){$("#container").append('<img class="img-thumbnail img-full" src="'+a+'" style="position: absolute; top: '+b+"px; left: "+d+'px" />')});$("#background").on("click",function(){$("#container").find(".img-full").remove();$(this).remove()})}});ActivatorPaginationView=Backbone.View.extend({events:{"click a.first":"gotoFirst","click a.prev":"gotoPrev","click a.next":"gotoNext",
"click a.last":"gotoLast","click a.page":"gotoPage"},template:_.template(h),initialize:function(){b.on("reset",this.render,this)},render:function(){if(!(b.state.currentPage==b.state.firstPage&&b.fullCollection.models.length<=b.state.pageSize)){b.state.pageSet=[];var a=5,c=b.state.currentPage,d=1;b.state.currentPage>a?d=b.state.currentPage-a:(a=10,c=d);for(a=b.state.currentPage+a<=b.state.totalPages?c+a:b.state.totalPages+1;d<a;d++)b.state.pageSet.push(d);this.$el.html(this.template(b.state));$("#pagination-container").append(this.$el)}},
gotoFirst:function(a){a.preventDefault();b.getPage(1)},gotoPrev:function(a){a.preventDefault();b.state.currentPage>b.state.firstPage&&b.getPreviousPage()},gotoNext:function(a){a.preventDefault();b.state.currentPage<b.state.lastPage&&b.getNextPage()},gotoLast:function(a){a.preventDefault();b.getPage(b.state.lastPage)},gotoPage:function(a){a.preventDefault();a=parseInt($(a.target).text());b.getPage(a)}});ActivatorAppView=Backbone.View.extend({el:$("#container"),initialize:function(){b.on("reset",this.addItems,
this);b.fetch({reset:!0,success:function(a,b){(new ActivatorPaginationView).render()}})},addItems:function(){$("#itemlist").empty();b.each(function(a){a=new ActivatorItemView({model:a});$("#itemlist").append(a.render())})}});new ActivatorAppView});
