var ActivatorItem={},ActivatorList={},ActivatorItemView={},ActivatorPaginationView={},ActivatorAppView={};require(["text!templates/item.tpl","text!templates/pagination.tpl","jquery","bootstrap","underscore","backbone","backbonePaginator"],function(a,b){"use strict";var c="";"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("baseUrl")&&(c=appConfig.baseUrl),ActivatorItem=Backbone.Model.extend({urlRoot:c+"index.php/item",idAttribute:"id",initialize:function(){"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("db_mapping")&&(appConfig.db_mapping.hasOwnProperty("name")&&""!==appConfig.db_mapping.name&&this.set("name",this.get(appConfig.db_mapping.name)),appConfig.db_mapping.hasOwnProperty("isactive")&&""!==appConfig.db_mapping.isactive&&this.set("isactive",this.get(appConfig.db_mapping.isactive)),appConfig.db_mapping.hasOwnProperty("image")&&""!==appConfig.db_mapping.image&&this.set("image",this.get(appConfig.db_mapping.image)))}}),ActivatorList=Backbone.PageableCollection.extend({model:ActivatorItem,url:c+"index.php/items",state:{firstPage:1,currentPage:1,pageSize:5}});var d=new ActivatorList([],{mode:"client"});ActivatorItemView=Backbone.View.extend({tagName:"li",className:"well",template:_.template(a),events:{"click #toggle-activate":"toggleActivate","click img":"toggleImage"},initialize:function(){},render:function(){var a=this.model,b="";""!==a.get("image")&&null!==a.get("image")&&"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("imagePath")&&""!==appConfig.imagePath&&0!==a.get("image").indexOf(c+appConfig.imagePath)?(b=c+appConfig.imagePath+a.get("image"),a.set("image",b)):(""===a.get("image")||null===a.get("image"))&&(b=c+"images/default.jpg",a.set("image",b));var e=a.toJSON();return e.show_delete="undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete?appConfig.show_delete:!1,e.show_info="undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_info")&&appConfig.show_info?appConfig.show_info:!1,this.$el.html(this.template(e)),this.$el.find("input").tooltip({placement:"top"}),"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete&&this.$el.find("#itemDelete-"+a.get("id")).find("#itemDeleteConfirm").on("click",function(){a.destroy({success:function(){d.getFirstPage({fetch:!0}),$(".modal-backdrop").remove()}})}),this.$el},toggleActivate:function(){var a=this.$el.find("#toggle-activate").get(0).checked?1:0;this.model.save({isactive:a}),this.render()},toggleImage:function(){var a=this.model.get("image"),b=this.$el.find("img").get(0).offsetTop,c=this.$el.find("img").get(0).offsetLeft;$("body").append('<div id="background"></div>'),$("#background").show("fast","linear",function(){$("#container").append('<img class="img-thumbnail img-full" src="'+a+'" style="position: absolute; top: '+b+"px; left: "+c+'px" />')}),$("#background").on("click",function(){$("#container").find(".img-full").remove(),$(this).remove()})}}),ActivatorPaginationView=Backbone.View.extend({events:{"click a.first":"gotoFirst","click a.prev":"gotoPrev","click a.next":"gotoNext","click a.last":"gotoLast","click a.page":"gotoPage"},template:_.template(b),initialize:function(){d.on("reset",this.render,this)},render:function(){if(d.state.currentPage==d.state.firstPage&&d.fullCollection.models.length<=d.state.pageSize);else{d.state.pageSet=[];var a=5,b=d.state.currentPage,c=1;d.state.currentPage>a?c=d.state.currentPage-a:(a=10,b=c);for(var e=d.state.currentPage+a<=d.state.totalPages?b+a:d.state.totalPages+1,f=c;e>f;f++)d.state.pageSet.push(f);this.$el.html(this.template(d.state)),$("#pagination-container").append(this.$el)}},gotoFirst:function(a){a.preventDefault(),d.getPage(1)},gotoPrev:function(a){a.preventDefault(),d.state.currentPage>d.state.firstPage&&d.getPreviousPage()},gotoNext:function(a){a.preventDefault(),d.state.currentPage<d.state.lastPage&&d.getNextPage()},gotoLast:function(a){a.preventDefault(),d.getPage(d.state.lastPage)},gotoPage:function(a){a.preventDefault();var b=parseInt($(a.target).text());d.getPage(b)}}),ActivatorAppView=Backbone.View.extend({el:$("#container"),initialize:function(){d.on("reset",this.addItems,this),d.fetch({reset:!0,success:function(){var a=new ActivatorPaginationView;a.render()}})},addItems:function(){$("#itemlist").empty(),d.each(function(a){var b=new ActivatorItemView({model:a});$("#itemlist").append(b.render())})}});new ActivatorAppView});