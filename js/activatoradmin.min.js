var ActivatorItem={},ActivatorList={},ActivatorItemView={},ActivatorPaginationView={},ActivatorAppView={};require(["text!templates/item.tpl","text!templates/pagination.tpl","jquery","bootstrap","underscore","backbone","backbonePaginator"],function(a,b){"use strict";var c="";"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("baseUrl")&&(c=appConfig.baseUrl);var d=5;"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("pageSize")&&(d=appConfig.pageSize),ActivatorItem=Backbone.Model.extend({urlRoot:c+"item",idAttribute:"id",initialize:function(){"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("db_mapping")&&(appConfig.db_mapping.hasOwnProperty("name")&&""!==appConfig.db_mapping.name&&this.set("name",this.get(appConfig.db_mapping.name)),appConfig.db_mapping.hasOwnProperty("isactive")&&""!==appConfig.db_mapping.isactive&&this.set("isactive",this.get(appConfig.db_mapping.isactive)),appConfig.db_mapping.hasOwnProperty("image")&&""!==appConfig.db_mapping.image&&this.set("image",this.get(appConfig.db_mapping.image)))}}),ActivatorList=Backbone.PageableCollection.extend({model:ActivatorItem,url:c+"items",state:{firstPage:1,currentPage:1,pageSize:d},search:function(a){if(""===a)return this;var b=d,c=0,e=new RegExp(a,"gi");return _(this.fullCollection.filter(function(a){var d=e.test(a.get("name"));return d&&b>c?(c++,!0):!1}))}});var e=new ActivatorList([],{mode:"client"});ActivatorItemView=Backbone.View.extend({tagName:"li",className:"well",template:_.template(a),events:{"click .toggle-activate":"toggleActivate","click img":"toggleImage"},initialize:function(){},render:function(){var a=this.model,b="";""!==a.get("image")&&null!==a.get("image")&&"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("imagePath")&&""!==appConfig.imagePath&&0!==a.get("image").indexOf(c+appConfig.imagePath)?(b=c+appConfig.imagePath+a.get("image"),a.set("image",b)):(""===a.get("image")||null===a.get("image"))&&(b=c+"images/default.jpg",a.set("image",b));var d=a.toJSON();return d.show_delete="undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete?appConfig.show_delete:!1,d.show_info="undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_info")&&appConfig.show_info?appConfig.show_info:!1,this.$el.html(this.template(d)),this.$el.find("label").tooltip({placement:"left"}),"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete&&this.$el.find("#itemDelete-"+a.get("id")).find("#itemDeleteConfirm").on("click",function(){a.destroy({success:function(){e.getFirstPage({fetch:!0}),$(".modal-backdrop").remove()}})}),this.$el},toggleActivate:function(){var a=this.$el.find(".toggle-activate").get(0).checked?1:0;this.model.save({isactive:a}),this.render()},toggleImage:function(){var a=this.model.get("image"),b=this.$el.find("img").get(0).offsetTop,c=this.$el.find("img").get(0).offsetLeft;$("body").append('<div id="background"></div>'),$("#background").show("fast","linear",function(){$("#container").append('<img class="img-thumbnail img-full" src="'+a+'" style="position: absolute; top: '+b+"px; left: "+c+'px" />')}),$("#background").on("click",function(){$("#container").find(".img-full").remove(),$(this).remove()})}}),ActivatorPaginationView=Backbone.View.extend({events:{"click a.first":"gotoFirst","click a.prev":"gotoPrev","click a.next":"gotoNext","click a.last":"gotoLast","click a.page":"gotoPage"},template:_.template(b),initialize:function(){e.on("reset",this.render,this)},render:function(){if(e.state.currentPage==e.state.firstPage&&e.fullCollection.models.length<=e.state.pageSize);else{e.state.pageSet=[];var a=5,b=e.state.currentPage,c=1;e.state.currentPage>a?c=e.state.currentPage-a:(a=10,b=c);for(var d=e.state.currentPage+a<=e.state.totalPages?b+a:e.state.totalPages+1,f=c;d>f;f++)e.state.pageSet.push(f);this.$el.html(this.template(e.state)),$("#pagination-container").append(this.$el)}},gotoFirst:function(a){a.preventDefault(),e.getPage(1)},gotoPrev:function(a){a.preventDefault(),e.state.currentPage>e.state.firstPage&&e.getPreviousPage()},gotoNext:function(a){a.preventDefault(),e.state.currentPage<e.state.lastPage&&e.getNextPage()},gotoLast:function(a){a.preventDefault(),e.getPage(e.state.lastPage)},gotoPage:function(a){a.preventDefault();var b=parseInt($(a.target).text());e.getPage(b)}}),ActivatorAppView=Backbone.View.extend({el:$("#container"),events:{"click #search":"search","keyup #searchterm":"entersearch","click #clearsearch":"clearsearch"},initialize:function(){e.on("reset",this.addItems,this),e.fetch({reset:!0,success:function(){var a=new ActivatorPaginationView;a.render()}})},addItems:function(){$("#itemlist").empty(),e.each(function(a){var b=new ActivatorItemView({model:a});$("#itemlist").append(b.render())})},search:function(){$("#itemlist").empty();var a=e.search($("#searchterm").val());a.each(function(a){var b=new ActivatorItemView({model:a});$("#itemlist").append(b.render())}),$("#pagination-container").hide()},entersearch:function(a){13==a.keyCode&&this.search()},clearsearch:function(){$("#itemlist").empty(),$("#searchterm").val(""),e.fetch({reset:!0,success:function(){$("#pagination-container").show()}})}});new ActivatorAppView});