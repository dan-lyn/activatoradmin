var ActivatorItem=!1,ActivatorList=!1,ActivatorItemView=!1,ActivatorPaginationView=!1,ActivatorAppView=!1;require(["text!templates/item.tpl","text!templates/pagination.tpl","jquery","bootstrap","underscore","backbone","backbonePaginator"],function(a,b){"use strict";var c="";"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("baseUrl")&&(c=appConfig.baseUrl),ActivatorItem=Backbone.Model.extend({urlRoot:c+"index.php/item",idAttribute:"id",initialize:function(){"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("db_mapping")&&(appConfig.db_mapping.hasOwnProperty("name")&&""!==appConfig.db_mapping.name&&this.set("name",this.get(appConfig.db_mapping.name)),appConfig.db_mapping.hasOwnProperty("isactive")&&""!==appConfig.db_mapping.isactive&&this.set("isactive",this.get(appConfig.db_mapping.isactive)),appConfig.db_mapping.hasOwnProperty("image")&&""!==appConfig.db_mapping.image&&this.set("image",this.get(appConfig.db_mapping.image)))}}),ActivatorList=Backbone.Paginator.clientPager.extend({model:ActivatorItem,paginator_core:{type:"GET",dataType:"json",url:c+"index.php/items"},paginator_ui:{firstPage:1,currentPage:1,perPage:10,totalPages:10},parse:function(a){return a}});var d=new ActivatorList;ActivatorItemView=Backbone.View.extend({tagName:"li",className:"well",template:_.template(a),events:{"click #toggle-activate":"toggleActivate","click img":"toggleImage"},initialize:function(){},render:function(){var a=this.model,b="";""!==a.get("image")&&null!==a.get("image")&&"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("imagePath")&&""!==appConfig.imagePath&&0!==a.get("image").indexOf(c+appConfig.imagePath)?(b=c+appConfig.imagePath+a.get("image"),a.set("image",b)):(""===a.get("image")||null===a.get("image"))&&(b=c+"images/default.jpg",a.set("image",b));var e=a.toJSON();return e.show_delete="undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete?appConfig.show_delete:!1,e.show_info="undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_info")&&appConfig.show_info?appConfig.show_info:!1,this.$el.html(this.template(e)),this.$el.find("input").tooltip({placement:"top"}),"undefined"!=typeof appConfig&&appConfig.hasOwnProperty("show_delete")&&appConfig.show_delete&&this.$el.find("#itemDelete-"+a.get("id")).find("#itemDeleteConfirm").on("click",function(){a.destroy({success:function(){d.pager(),$(".modal-backdrop").remove()}})}),this.$el},toggleActivate:function(){var a=this.$el.find("#toggle-activate").get(0).checked?1:0;this.model.save({isactive:a}),this.render()},toggleImage:function(){var a=this.model.get("image"),b=this.$el.find("img").get(0).offsetTop,c=this.$el.find("img").get(0).offsetLeft;$("body").append('<div id="background"></div>'),$("#background").show("fast","linear",function(){$("#container").append('<img class="img-thumbnail img-full" src="'+a+'" style="position: absolute; top: '+b+"px; left: "+c+'px" />')}),$("#background").on("click",function(){$("#container").find(".img-full").remove(),$(this).remove()})}}),ActivatorPaginationView=Backbone.View.extend({events:{"click a.first":"gotoFirst","click a.prev":"gotoPrev","click a.next":"gotoNext","click a.last":"gotoLast","click a.page":"gotoPage"},template:_.template(b),initialize:function(){d.on("reset",this.render,this)},render:function(){d.currentPage==d.firstPage&&d.origModels.length<=d.perPage||(this.$el.html(this.template(d.info())),$("#pagination-container").append(this.$el))},gotoFirst:function(a){a.preventDefault(),d.goTo(1)},gotoPrev:function(a){a.preventDefault(),d.previousPage()},gotoNext:function(a){a.preventDefault(),d.nextPage()},gotoLast:function(a){a.preventDefault(),d.goTo(d.information.lastPage)},gotoPage:function(a){a.preventDefault();var b=$(a.target).text();d.goTo(b)}}),ActivatorAppView=Backbone.View.extend({el:$("#container"),initialize:function(){d.on("reset",this.addItems,this),d.fetch({reset:!0,success:function(){d.pager();var a=new ActivatorPaginationView;a.render()}})},addItems:function(){$("#itemlist").empty(),d.each(function(a){var b=new ActivatorItemView({model:a});$("#itemlist").append(b.render())})}});new ActivatorAppView});